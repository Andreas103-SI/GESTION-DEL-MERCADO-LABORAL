<!DOCTYPE html>
<html>
<head>
    <title>Dashboard de Ofertas</title>
    <style>
        .section { margin-bottom: 20px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; }
        h1, h2 { color: #333; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <h1>Dashboard de Ofertas</h1>

    <!-- Formulario de búsqueda para ofertas -->
    <div class="section">
        <h2>Filtrar Ofertas Recientes</h2>
        <form method="get">
            <input type="text" name="search" value="{{ search_query }}" placeholder="Buscar por título, empresa o ubicación">
            <button type="submit">Buscar</button>
        </form>
    </div>

    <!-- Habilidades más demandadas -->
    <div class="section">
        <h2>Habilidades más demandadas (último mes)</h2>
        <ul>
            {% for skill in skills_demand %}
                {% if skill.skills__name %}
                    <li>{{ skill.skills__name|capitalize }}: {{ skill.count }} ofertas</li>
                {% endif %}
            {% empty %}
                <li>No hay datos de habilidades.</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Ofertas por fuente -->
    <div class="section">
        <h2>Ofertas por fuente</h2>
        <ul>
            {% for source in sources_count %}
                <li>{{ source.source }}: {{ source.count }} ofertas</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Habilidades en Asturias -->
    <div class="section">
        <h2>Habilidades más demandadas en Asturias</h2>
        <ul>
            {% for skill in asturias_skills %}
                {% if skill.skills__name %}
                    <li>{{ skill.skills__name|capitalize }}: {{ skill.count }} ofertas</li>
                {% endif %}
            {% empty %}
                <li>No hay datos para Asturias.</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Comparación entre plataformas -->
    <div class="section">
        <h2>Comparación entre plataformas</h2>
        {% for source, skills in platform_comparison.items %}
            <h3>{{ source }}</h3>
            <ul>
                {% for skill in skills %}
                    <li>{{ skill.name }}: {{ skill.count }} ofertas</li>
                {% empty %}
                    <li>No hay datos para {{ source }}.</li>
                {% endfor %}
            </ul>
        {% endfor %}
    </div>

    <!-- Predicciones de habilidades futuras -->
    <div class="section">
        <h2>Habilidades con mayor demanda prevista (próximos 30 días)</h2>
        <ul>
            {% for trend in future_skills %}
                <li>{{ trend.skill }}: {{ trend.predicted_demand }} ofertas previstas</li>
            {% empty %}
                <li>No hay predicciones disponibles.</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Recomendaciones de tareas -->
    <div class="section">
        <h2>Tareas recomendadas para ti</h2>
        <ul>
            {% for task in recommended_tasks %}
                <li>{{ task.title }} (Prioridad: {{ task.priority|title }}) - Habilidades: {% for skill in task.skills.all %}{{ skill.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</li>
            {% empty %}
                <li>No hay tareas recomendadas.</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Total de ofertas -->
    <div class="section">
        <h2>Total de ofertas (último mes)</h2>
        <p>{{ total_offers }} ofertas</p>
    </div>

    <!-- Empresas con más ofertas -->
    <div class="section">
        <h2>Empresas con más ofertas</h2>
        <ul>
            {% for company in companies_count %}
                <li>{{ company.company }}: {{ company.count }} ofertas</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Ofertas recientes -->
    <div class="section">
        <h2>Ofertas recientes</h2>
        <ul>
            {% for offer in recent_offers %}
                <li>{{ offer.title }} - {{ offer.company }} ({{ offer.location }}) - <a href="{{ offer.url }}">Ver oferta</a></li>
            {% empty %}
                <li>No hay ofertas recientes.</li>
            {% endfor %}
        </ul>
    </div>

    <div class="section">
        <form method="post" action="{% url 'update_scraper' %}">
            {% csrf_token %}
            <input type="hidden" name="source" value="LinkedIn">
            <button type="submit">Actualizar LinkedIn</button>
        </form>
        <form method="post" action="{% url 'update_scraper' %}">
            {% csrf_token %}
            <input type="hidden" name="source" value="Tecnoempleo">
            <button type="submit">Actualizar Tecnoempleo</button>
        </form>
    </div>
</body>
</html>